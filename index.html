<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediCore - Advanced Medical Platform</title>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Simple Peer (Video Call) -->
    <script src="https://cdn.jsdelivr.net/npm/simple-peer@9.11.1/simplepeer.min.js"></script>
    
    <!-- Our CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="dark-mode">
    <!-- Floating Emergency Button -->
    <div class="floating-emergency" id="emergencyFloat">
        <i class="fas fa-ambulance"></i>
    </div>

    <div class="app">
        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="logo">
                <i class="fas fa-clinic-medical" style="color:#3b82f6;"></i>
                <strong>MediCore</strong>
            </div>
            <div class="dark-mode-toggle" id="themeToggle">
                <i class="fas fa-moon" id="themeIcon"></i>
                <span id="themeText">Dark mode</span>
            </div>
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span id="globalUserName">Guest</span>
            </div>
        </nav>

        <!-- Login Section -->
        <section id="authSection" class="auth-section">
            <div class="glass-card login-card">
                <h2 class="text-center">üîê Secure Login</h2>
                <div class="role-selector">
                    <button class="btn" id="loginAsDoctorBtn">
                        <i class="fas fa-user-md"></i> I'm a Doctor
                    </button>
                    <button class="btn" id="loginAsPatientBtn">
                        <i class="fas fa-user"></i> I'm a Patient
                    </button>
                </div>
                <form id="loginForm" class="login-form">
                    <div class="input-group glow-border">
                        <input type="email" class="input-animated" id="loginEmail" placeholder="Email" value="doctor@medicore.com">
                    </div>
                    <div class="input-group glow-border">
                        <input type="password" class="input-animated" id="loginPassword" placeholder="Password" value="password123">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%;">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                <p class="text-note">Demo: Use any credentials</p>
            </div>
        </section>

        <!-- Doctor Dashboard -->
        <section id="doctorDashboard" class="dashboard" style="display: none;">
            <div class="dashboard-layout">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <div class="sidebar-header">
                        <i class="fas fa-stethoscope"></i>
                        <span>Dr. Sarah</span>
                    </div>
                    <nav class="sidebar-nav">
                        <a href="#" class="active"><i class="fas fa-calendar-check"></i> Appointments</a>
                        <a href="#"><i class="fas fa-comment-dots"></i> Live Chat</a>
                        <a href="#"><i class="fas fa-file-prescription"></i> Prescriptions</a>
                        <a href="#"><i class="fas fa-users"></i> Patients</a>
                    </nav>
                </aside>

                <!-- Main Content -->
                <main class="main-content">
                    <div class="dashboard-header">
                        <h2><i class="fas fa-user-md"></i> Doctor Dashboard</h2>
                        <div class="header-actions">
                            <i class="fas fa-bell"></i>
                            <span class="badge">3</span>
                            <span class="user-badge">
                                <i class="fas fa-user-circle"></i> Dr. Sarah
                            </span>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-heartbeat"></i>
                            <div class="stat-info">
                                <h3>248</h3>
                                <p>Total Patients</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-clock"></i>
                            <div class="stat-info">
                                <h3 id="pendingCount">3</h3>
                                <p>Pending</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-check-circle"></i>
                            <div class="stat-info">
                                <h3>15</h3>
                                <p>Approved</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-calendar-week"></i>
                            <div class="stat-info">
                                <h3>18</h3>
                                <p>Today</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex-row">
                        <!-- Live Chat -->
                        <div class="chat-window-left">
                            <div class="chat-header">
                                <i class="fas fa-circle online"></i>
                                <strong>Dr. Adams ¬∑ Online</strong>
                            </div>
                            <div class="chat-messages" id="chatMessages"></div>
                            <div class="chat-input">
                                <input type="text" class="input-animated" placeholder="Type a message..." id="chatInput">
                                <button class="btn-icon" id="sendChatBtn"><i class="fas fa-paper-plane"></i></button>
                            </div>
                        </div>

                        <!-- Right Content -->
                        <div class="content-right">
                            <!-- Appointment Approval -->
                            <div class="card">
                                <h3><i class="fas fa-user-check"></i> Appointment Approval</h3>
                                <div id="doctorAppointmentList" class="appointment-list"></div>
                            </div>

                            <!-- Prescription Upload -->
                            <div class="upload-card" id="prescriptionUpload">
                                <i class="fas fa-cloud-upload-alt fa-3x"></i>
                                <h4>Upload Prescription</h4>
                                <p>Click to upload</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </section>

        <!-- Patient Dashboard -->
        <section id="patientDashboard" class="dashboard" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-user"></i> Patient Dashboard</h2>
                <span class="user-badge"><i class="fas fa-user-circle"></i> <span id="patientName">Alex</span></span>
            </div>

            <!-- Digital QR Card -->
            <div class="qr-card">
                <div class="qr-code">
                    <i class="fas fa-qrcode fa-4x"></i>
                </div>
                <div class="qr-info">
                    <h3>Digital Health Card</h3>
                    <p>ID: MC-44-899-221</p>
                    <p>Valid Until: 12/2026</p>
                </div>
            </div>

            <!-- Emergency Map Section -->
            <div class="card map-card">
                <h3><i class="fas fa-map-marked-alt"></i> Emergency Locator</h3>
                <div id="emergencyMap" class="map-container"></div>
                <div class="map-controls">
                    <button class="btn" id="findNearestHospital">
                        <i class="fas fa-hospital"></i> Nearest Hospital
                    </button>
                    <button class="btn" id="navigateToHospital">
                        <i class="fas fa-directions"></i> Navigate
                    </button>
                    <span class="distance-badge" id="hospitalDistance">üìç Finding location...</span>
                </div>
            </div>

            <!-- Hospital List -->
            <div class="card" style="margin-top: 1rem;">
                <h4><i class="fas fa-hospital"></i> Nearby Hospitals</h4>
                <div id="hospitalListContainer" style="max-height: 300px; overflow-y: auto; padding: 0.5rem;">
                    <div style="text-align: center; padding: 2rem;" id="hospitalLoading">
                        <i class="fas fa-spinner fa-spin"></i> Loading hospitals...
                    </div>
                </div>
            </div>

            <!-- Insurance Card -->
            <div class="card">
                <h4><i class="fas fa-shield-alt"></i> Insurance Status</h4>
                <div class="progress-bar">
                    <div class="progress-fill" style="width:65%"></div>
                </div>
                <p>65% Coverage ‚Ä¢ $5,000 remaining</p>
            </div>

            <!-- Patient Chat -->
            <div class="card">
                <h3><i class="fas fa-comment-dots"></i> Chat with Doctor</h3>
                <div id="patientChatMessages" class="chat-messages" style="height: 200px; margin-bottom: 1rem; overflow-y: auto;"></div>
                <div class="chat-input">
                    <input type="text" class="input-animated" id="patientChatInput" placeholder="Type your message...">
                    <button class="btn-icon" id="patientSendChatBtn"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>

            <!-- Book Appointment -->
            <div class="card">
                <h3><i class="fas fa-calendar-plus"></i> Book Appointment</h3>
                <div class="appointment-booking">
                    <select class="input-animated" id="doctorSelect">
                        <option value="Dr. Sarah">Dr. Sarah (Cardiology)</option>
                        <option value="Dr. Adams">Dr. Adams (Neurology)</option>
                    </select>
                    <input type="date" class="input-animated" id="appointmentDate">
                    <button class="btn btn-primary" id="bookAppointmentBtn">Request Appointment</button>
                </div>
                <p id="bookingMessage" class="success-message"></p>
            </div>

            <!-- Appointments List -->
            <h3>Your Appointments</h3>
            <div id="patientAppointmentList" class="appointment-list"></div>

            <!-- Emergency Button -->
            <button class="btn btn-emergency" id="patientEmergencyBtn">
                üî¥ One-Click Emergency
            </button>
        </section>

        <!-- Emergency Overlay -->
        <div id="emergencyOverlay" class="emergency-overlay" style="display: none;">
            <div class="emergency-content">
                <h2><i class="fas fa-exclamation-triangle"></i> EMERGENCY ACTIVATED</h2>
                <div class="emergency-details">
                    <p><i class="fas fa-location-dot"></i> Live location shared</p>
                    <p><i class="fas fa-ambulance"></i> Ambulance dispatched</p>
                </div>
                <button class="btn btn-light" id="dismissEmergency">Dismiss</button>
            </div>
        </div>
    </div>

    <!-- Video Call Modal - ‡§è‡§ï‡§¶‡§æ‡§ö ‡§Ø‡•á‡§•‡•á -->
    <div id="videoCallModal" class="video-modal" style="display: none;">
        <div class="video-modal-content">
            <div class="video-modal-header">
                <h3><i class="fas fa-video"></i> Video Consultation</h3>
                <button class="btn-icon" id="closeVideoModal"><i class="fas fa-times"></i></button>
            </div>
            <div class="video-container">
                <div class="local-video-container">
                    <video id="localVideo" autoplay muted playsinline></video>
                    <div class="video-label">You</div>
                </div>
                <div class="remote-video-container">
                    <video id="remoteVideo" autoplay playsinline></video>
                    <div class="video-label">Doctor</div>
                </div>
            </div>
            <div class="video-controls">
                <button class="btn-icon video-control-btn" id="muteAudioBtn" title="Mute Audio">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="btn-icon video-control-btn" id="pauseVideoBtn" title="Pause Video">
                    <i class="fas fa-video"></i>
                </button>
                <button class="btn-icon video-control-btn" id="screenShareBtn" title="Share Screen">
                    <i class="fas fa-desktop"></i>
                </button>
                <button class="btn-icon video-control-btn" id="fullScreenBtn" title="Full Screen">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="btn-icon video-control-btn end-call" id="endCallBtn" title="End Call">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
            <div class="call-status" id="callStatus">Connecting...</div>
        </div>
    </div>

    <!-- Video Call Button -->
    <div style="position: fixed; bottom: 20px; left: 20px; z-index: 1000;">
        <button class="btn btn-primary" id="startVideoCallBtn" style="display: none;">
            <i class="fas fa-video"></i> Start Video Call
        </button>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="main.js"></script>
    
    <!-- Hospital List Fix Script -->
    <script>
    (function() {
        console.log("üè• Hospital list fix loaded");
        
        // Default hospitals data (Pune)
        const defaultHospitals = [
            {
                name: "Sahyadri Hospital",
                lat: 18.5124, lng: 73.8567,
                phone: "020-24456789",
                address: "Bhandarkar Road, Deccan",
                distance: 1.2, rating: 4.5
            },
            {
                name: "Jehangir Hospital",
                lat: 18.5254, lng: 73.8747,
                phone: "020-26055100",
                address: "Sassoon Road, Camp",
                distance: 2.5, rating: 4.3
            },
            {
                name: "KEM Hospital",
                lat: 18.5264, lng: 73.8667,
                phone: "020-66037300",
                address: "Rasta Peth, Pune",
                distance: 2.8, rating: 4.0
            },
            {
                name: "Ruby Hall Clinic",
                lat: 18.5314, lng: 73.8737,
                phone: "020-26163391",
                address: "Sassoon Road, Camp",
                distance: 3.1, rating: 4.4
            },
            {
                name: "Sancheti Hospital",
                lat: 18.5154, lng: 73.8567,
                phone: "020-66065000",
                address: "Shivajinagar",
                distance: 1.5, rating: 4.2
            }
        ];
        
        // Function to show hospitals
        window.showHospitalsDirect = function(hospitals = defaultHospitals) {
            const container = document.getElementById('hospitalListContainer');
            if(!container) return;
            
            if(!hospitals || hospitals.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem;">No hospitals found</div>';
                return;
            }
            
            let html = '';
            hospitals.forEach((h, index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üè•';
                const distance = h.distance ? h.distance.toFixed(1) : '?';
                
                html += `
                    <div class="hospital-item" onclick="window.app?.focusHospital(${h.lat}, ${h.lng})">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <b>${medal} ${h.name}</b><br>
                                <small>üìç ${h.address || 'Pune'}</small><br>
                                <small>üìû ${h.phone || 'N/A'}</small>
                            </div>
                            <div style="text-align: right;">
                                <b style="color: ${index === 0 ? '#22c55e' : '#ef4444'};">${distance} km</b><br>
                                <small>${h.rating || '4.5'} ‚≠ê</small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            console.log("‚úÖ Hospitals displayed:", hospitals.length);
        };
        
        // Show hospitals immediately
        window.showHospitalsDirect();
        
        // Connect with main app
        let checkApp = setInterval(function() {
            if(window.app) {
                console.log("‚úÖ App loaded, connecting...");
                window.app.showHospitalList = window.showHospitalsDirect;
                clearInterval(checkApp);
            }
        }, 500);
    })();
    </script>

    <!-- Video Call Test Button - ‡§§‡§æ‡§§‡•ç‡§™‡•Å‡§∞‡§§‡§æ -->
    <script>
    // Video call button ‡§¶‡§æ‡§ñ‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä
    setTimeout(function() {
        let btn = document.getElementById('startVideoCallBtn');
        if(btn) {
            btn.style.display = 'block';
            console.log("‚úÖ Video button shown");
        }
        
        // Test modal open
        window.testVideo = function() {
            document.getElementById('videoCallModal').style.display = 'flex';
        };
    }, 2000);
    </script>
</body>
</html>